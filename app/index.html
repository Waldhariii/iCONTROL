<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>iCONTROL</title>
    <!-- ICONTROL_CRITICAL_CSS_V1: fond immédiat pour éviter flash blanc (first paint). -->
    <style>
      html, body { margin: 0; padding: 0; min-height: 100vh; overflow-x: hidden; }
      body { background: #0f1112; color: #e7ecef; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
      #app { min-height: 100vh; display: flex; align-items: center; justify-content: center; }
      #icontrol-boot { opacity: 0.85; font-size: 14px; color: #a7b0b7; }
    </style>
  </head>
  <body>
    <div id="app"><div id="icontrol-boot" aria-live="polite">Chargement…</div></div>
    <script>
      // DEV-only diagnostics: if the boot placeholder survives, show actionable info.
      (function () {
        const bootEl = document.getElementById("icontrol-boot");
        if (!bootEl) return;
        const base = location.origin + "/app";
        const bust = Date.now();
        const probes = [
          base + "/src/main.ts?bust=" + bust,
          base + "/api/runtime-config?bust=" + bust,
        ];
        const fmt = (label, ok, extra) =>
          `${ok ? "OK" : "ERR"} ${label}${extra ? " — " + extra : ""}`;
        setTimeout(async () => {
          if (!document.getElementById("icontrol-boot")) return;
          try {
            const results = [];
            for (const url of probes) {
              try {
                const res = await fetch(url, { cache: "no-store" });
                results.push(
                  fmt(
                    url.replace(location.origin, ""),
                    res.ok,
                    res.headers.get("content-type") || String(res.status),
                  ),
                );
              } catch (e) {
                results.push(fmt(url.replace(location.origin, ""), false, String(e)));
              }
            }
            bootEl.innerHTML =
              "<div style=\"max-width:720px;padding:12px 16px;text-align:left;border:1px solid #2a2f33;border-radius:8px;background:#111517;\">" +
              "<div style=\"font-weight:600;margin-bottom:6px;\">Boot bloqué (diagnostic rapide)</div>" +
              "<div style=\"margin-bottom:8px;opacity:0.9;\">Si ceci reste affiché, le module principal ne s'exécute pas côté navigateur.</div>" +
              "<pre style=\"white-space:pre-wrap;margin:0 0 10px 0;font:12px/1.4 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;\">" +
              results.join("\n") +
              "</pre>" +
              "<a href=\"/app/#/login?bust=" +
              bust +
              "\" style=\"color:#9ad1ff;\">Ouvrir /app/#/login (cache-bust)</a>" +
              "</div>";
          } catch (e) {
            bootEl.textContent = "Boot bloqué (diagnostic indisponible): " + String(e);
          }
        }, 3500);
      })();
    </script>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
