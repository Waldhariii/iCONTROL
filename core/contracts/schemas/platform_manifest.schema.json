{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "platform_manifest.v1",
  "title": "platform_manifest",
  "type": "object",
  "required": ["manifest_id", "manifest_version", "manifest_env", "release_id", "signature", "checksums", "compat_matrix", "routes", "nav", "pages", "widgets", "themes", "permissions", "datasources", "workflows", "capabilities", "modules", "entitlements", "plans", "plan_versions", "tenant_entitlements", "tenant_quotas", "metering_catalog", "budget_policies", "qos_policies", "qos_runtime_config", "extensions_runtime", "data_catalog", "retention_policies", "export_controls", "integrations", "security", "sre", "ops", "compat", "domain_modules", "module_activations", "marketplace", "billing"],
  "additionalProperties": false,
  "properties": {
    "manifest_id": {"type": "string"},
    "manifest_version": {"type": "string"},
    "manifest_env": {"type": "string"},
    "release_id": {"type": "string"},
    "signature": {"type": "string"},
    "checksums": {"$ref": "checksums.v1"},
    "compat_matrix": {"$ref": "compat_matrix.v1"},
    "routes": {"$ref": "route_catalog.v1"},
    "nav": {"$ref": "nav_manifest.v1"},
    "pages": {"$ref": "render_graph.v1"},
    "widgets": {"type": "array", "items": {"type": "object"}},
    "themes": {"$ref": "theme_manifest.v1"},
    "permissions": {"$ref": "guards.v1"},
    "datasources": {"$ref": "datasource_contracts.v1"},
    "workflows": {"$ref": "workflow_dags.v1"},
    "capabilities": {"type": "array", "items": {"type": "string"}},
    "modules": {"type": "array", "items": {"type": "string"}},
    "entitlements": {"type": "array", "items": {"type": "object"}},
    "plans": {"type": "array", "items": {"type": "object"}},
    "plan_versions": {"type": "array", "items": {"type": "object"}},
    "tenant_entitlements": {"type": "array", "items": {"type": "object"}},
    "tenant_quotas": {"type": "array", "items": {"type": "object"}},
    "metering_catalog": {"type": "array", "items": {"type": "object"}},
    "budget_policies": {"type": "array", "items": {"type": "object"}},
    "qos_policies": {"type": "array", "items": {"type": "object"}},
    "qos_runtime_config": {"type": "array", "items": {"type": "object"}},
    "extensions_runtime": {"type": "array", "items": {"type": "object"}},
    "data_catalog": {"type": "object"},
    "retention_policies": {"type": "array", "items": {"type": "object"}},
    "export_controls": {"type": "array", "items": {"type": "object"}},
    "integrations": {"type": "object"},
    "security": {
      "type": "object",
      "additionalProperties": false,
      "required": ["secret_bindings_summary", "policies_summary", "refs_summary", "s2s_summary"],
      "properties": {
        "secret_bindings_summary": { "type": "array", "items": { "type": "object" } },
        "policies_summary": { "type": "array", "items": { "type": "object" } },
        "refs_summary": { "type": "array", "items": { "type": "object" } },
        "s2s_summary": {
          "type": "object",
          "additionalProperties": false,
          "required": ["principals", "credentials", "token_policies"],
          "properties": {
            "principals": { "type": "array", "items": { "type": "object" } },
            "credentials": { "type": "array", "items": { "type": "object" } },
            "token_policies": { "type": "array", "items": { "type": "object" } }
          }
        }
      }
    },
    "sre": {"type": "object"},
    "ops": {"type": "object"},
    "compat": {"type": "object"},
    "domain_modules": {"type": "array", "items": {"type": "object"}},
    "module_activations": {"type": "array", "items": {"type": "object"}},
    "marketplace": {
      "type": "object",
      "additionalProperties": false,
      "required": ["catalog"],
      "properties": {
        "catalog": {"type": "array", "items": { "$ref": "marketplace_catalog_item.v1" } },
        "sources": {"type": "array", "items": { "$ref": "marketplace_catalog_source.v1" } },
        "versions": {"type": "array", "items": { "$ref": "marketplace_catalog_version.v1" } }
      }
    },
    "billing": {
      "type": "object",
      "additionalProperties": false,
      "required": ["billing_mode", "providers", "provider_versions", "rating_rules", "rating_versions"],
      "properties": {
        "billing_mode": { "$ref": "billing_mode.v1" },
        "providers": { "type": "array", "items": { "$ref": "billing_provider.v1" } },
        "provider_versions": { "type": "array", "items": { "$ref": "billing_provider_version.v1" } },
        "rating_rules": { "type": "array", "items": { "$ref": "rating_rule.v1" } },
        "rating_versions": { "type": "array", "items": { "$ref": "rating_version.v1" } }
      }
    }
  }
}
